montageDefine("443a4e8","core/meta/object-descriptor",{dependencies:["../core","./derived-descriptor","./event-descriptor","./model","../promise","./property-descriptor","./validation-rule","../deprecate","../core","../core","../core","../core"],factory:function(e,r,t){var o=e("../core").Montage,i=e("./derived-descriptor").DerivedDescriptor,p=e("./event-descriptor").EventDescriptor,n=e("./model"),s=e("../promise").Promise,a=e("./property-descriptor").PropertyDescriptor,c=e("./validation-rule").PropertyValidationRule,u=e("../deprecate"),d={name:"default",customPrototype:!1},l=r.ObjectDescriptor=o.specialize({FileExtension:{value:".mjson"},constructor:{value:function(){this._eventDescriptors=[],this._propertyDescriptors=[],this.addRangeAtPathChangeListener("_propertyDescriptors",this,"_handlePropertyDescriptorsRangeChange"),this._propertyDescriptorGroups={},Object.defineProperty(this,"_propertyDescriptorsTable",{value:{},writable:!1}),Object.defineProperty(this,"_eventPropertyDescriptorsTable",{value:{},writable:!1}),this.defineBinding("eventDescriptors",{"<-":"_eventDescriptors.concat(parent.eventDescriptors)"})}},initWithName:{value:function(e){return this._name=null!==e?e:"default",this.customPrototype=!1,this}},serializeSelf:{value:function(e){e.setProperty("name",this.name),this._model&&!this.model.isDefault&&e.setProperty("model",this._model,"reference"),this.objectDescriptorInstanceModule&&e.setProperty("objectDescriptorModule",this.objectDescriptorInstanceModule),this._parent&&e.setProperty("parent",this._parent),this._setPropertyWithDefaults(e,"customPrototype",this.customPrototype),this._propertyDescriptors.length>0&&e.setProperty("propertyDescriptors",this._propertyDescriptors),Object.getOwnPropertyNames(this._propertyDescriptorGroups).length>0&&e.setProperty("propertyDescriptorGroups",this._propertyDescriptorGroups),this._eventDescriptors.length>0&&e.setProperty("eventDescriptors",this._eventDescriptors),this._propertyValidationRules.length>0&&e.setProperty("propertyValidationRules",this._propertyValidationRules),"number"==typeof this.maxAge&&e.setProperty("maxAge",this.maxAge)}},deserializeSelf:{value:function(e){var r,t;r=e.getProperty("name"),void 0!==r&&(this._name=r),r=e.getProperty("model")||e.getProperty("binder"),r&&(this._model=r),r=e.getProperty("objectDescriptorModule")||e.getProperty("blueprintModule"),void 0!==r&&(this.objectDescriptorInstanceModule=r),t=e.getProperty("parent"),t&&(t.promise&&t.valueFromReference?(u.deprecationWarningOnce("parent reference via ObjectDescriptorReference","direct reference with object syntax"),this._parentReference=t):this._parent=t),this.customPrototype=this._getPropertyWithDefaults(e,"customPrototype"),r=e.getProperty("propertyDescriptors")||e.getProperty("propertyBlueprints"),r&&(this._propertyDescriptors=r),r=e.getProperty("propertyDescriptorGroups")||e.getProperty("propertyBlueprintGroups"),r&&(this._propertyDescriptorGroups=r),r=e.getProperty("eventDescriptors")||e.getProperty("eventBlueprints"),r&&(this._eventDescriptors=r),r=e.getProperty("propertyValidationRules"),r&&(this._propertyValidationRules=r),r=e.getProperty("maxAge"),r&&(this.maxAge=r)}},_setPropertyWithDefaults:{value:function(e,r,t){t!==d[r]&&e.setProperty(r,t)}},_getPropertyWithDefaults:{value:function(e,r){var t=e.getProperty(r);return t||this[r]||d[r]}},_name:{value:null},name:{get:function(){return this._name}},create:{value:function(e,r,t){var o;if("undefined"==typeof e||l.prototype.isPrototypeOf(e)){var i=Object.getPrototypeOf(l).create;return i.call(this,"undefined"==typeof e?this:e,r,t)}return o="function"==typeof e.specialize||r?e.specialize(r,t):new e,this.ObjectProperty.applyWithObjectDescriptor(o.prototype,this),this.customPrototype=!0,o}},newInstance:{value:function(){var e=this.newInstancePrototype();return e?new e:null}},newInstancePrototype:{value:function(){if(this.customPrototype)throw new Error("Already has customPrototype");var e=this.parent?this.parent.newInstancePrototype():o,r=e.specialize({init:{value:function(){return this}}});return this.ObjectProperty.applyWithObjectDescriptor(r.prototype,this),r?r:null}},ObjectProperty:{serializable:!1,enumerable:!0,get:function(){return this.model?this.model.ObjectProperty:n.Model.group.defaultObjectDescriptorObjectProperty}},objectDescriptorInstanceModule:{serializable:!1,value:null},identifier:{get:function(){return["objectDescriptor",(this.name||"unnamed").toLowerCase()].join("_")}},_model:{value:null},model:{serializable:!1,get:function(){return this._model||(this._model=n.Model.group.defaultModel,this._model.addObjectDescriptor(this)),this._model},set:function(e){this._model=e}},_parentReference:{value:null},_parent:{value:null},parent:{serializable:!1,get:function(){return this._parent},set:function(e){this._parent=e}},customPrototype:{value:!1},_propertyDescriptors:{value:null},_handlePropertyDescriptorsRangeChange:{value:function(e,r,t){var o,i;for(o=0,i=r.length;o<i;++o)r[o]._owner=null;for(o=0,i=e.length;o<i;++o)e[o]._owner=e[o]._owner||this}},propertyDescriptors:{get:function(){var e=[];return e=e.concat(this._propertyDescriptors),this.parent&&(e=e.concat(this.parent.propertyDescriptors)),e}},serializablePropertyDescriptors:{get:function(){return this.propertyDescriptors.filter(function(e){return e.serializable!==!1})}},_propertyDescriptorsTable:{value:null},addPropertyDescriptor:{value:function(e){if(null!==e&&null!==e.name){var r=this._propertyDescriptors.indexOf(e);r<0&&(null!==e.owner&&e.owner!==this&&e.owner.removePropertyDescriptor(e),this._propertyDescriptors.push(e),this._propertyDescriptorsTable[e.name]=e,e._owner=this)}return e}},removePropertyDescriptor:{value:function(e){if(null!==e&&null!==e.name){var r=this._propertyDescriptors.indexOf(e);r>=0&&(this._propertyDescriptors.splice(r,1),delete this._propertyDescriptorsTable[e.name],e._owner=null)}return e}},newPropertyDescriptor:{value:function(e,r){return(new a).initWithNameObjectDescriptorAndCardinality(e,this,r)}},addToOnePropertyDescriptorNamed:{value:function(e){return this.addPropertyDescriptor(this.newPropertyDescriptor(e,1))}},addToManyPropertyDescriptorNamed:{value:function(e){return this.addPropertyDescriptor(this.newPropertyDescriptor(e,1/0))}},addToOneAssociationBlueprintNamed:{value:function(e,r){var t=this.addPropertyDescriptor(this.addToOnePropertyDescriptorNamed(e));return r&&(t.valueDescriptor=r.owner,r.valueDescriptor=this),t}},addToManyAssociationBlueprintNamed:{value:function(e,r){var t=this.addPropertyDescriptor(this.addToManyPropertyDescriptorNamed(e));return r&&(t.valueDescriptor=r.owner,r.valueDescriptor=this),t}},propertyDescriptorForName:{value:function(e){var t=this._propertyDescriptorsTable[e];if(void 0===t){t=r.UnknownPropertyDescriptor;var o,i;for(i=0;"undefined"!=typeof(o=this._propertyDescriptors[i]);i++)if(o.name===e){t=o;break}this._propertyDescriptorsTable[e]=t}return t===r.UnknownPropertyDescriptor&&(t=null),!t&&this.parent&&(t=this.parent.propertyDescriptorForName(e)),t}},_propertyDescriptorGroups:{value:null},propertyDescriptorGroups:{get:function(){var e,r=[];for(e in this._propertyDescriptorGroups)this._propertyDescriptorGroups.hasOwnProperty(e)&&r.push(e);return this.parent&&(r=r.concat(this.parent.propertyDescriptorGroups)),r}},propertyDescriptorGroupForName:{value:function(e){var r=this._propertyDescriptorGroups[e];return!r&&this.parent&&(r=this.parent.propertyDescriptorGroupForName(e)),r}},addPropertyDescriptorGroupNamed:{value:function(e){var r=this._propertyDescriptorGroups[e];return r||(r=[],this._propertyDescriptorGroups[e]=r),r}},removePropertyDescriptorGroupNamed:{value:function(e){var r=this._propertyDescriptorGroups[e];return r||delete this._propertyDescriptorGroups[e],r}},addPropertyDescriptorToGroupNamed:{value:function(e,r){var t,o=this._propertyDescriptorGroups[r];return o||(o=this.addPropertyDescriptorGroupNamed(r)),t=o.indexOf(e),t<0&&o.push(e),o}},removePropertyDescriptorFromGroupNamed:{value:function(e,r){var t=this._propertyDescriptorGroups[r];if(t&&e){var o=t.indexOf(e);o>=0&&t.splice(o,1)}return t||[]}},_eventDescriptors:{value:null},eventDescriptors:{value:null},_eventPropertyDescriptorsTable:{value:null},addEventDescriptor:{value:function(e){if(e&&e.name){var r=this._eventDescriptors.indexOf(e);r<0&&(e.owner&&e.owner!==this&&e.owner.removeEventDescriptor(e),this._eventDescriptors.push(e),this._eventPropertyDescriptorsTable[e.name]=e,e._owner=this)}return e}},removeEventDescriptor:{value:function(e){if(e&&e.name){var r=this._eventDescriptors.indexOf(e);r>=0&&(this._eventDescriptors.splice(r,1),delete this._eventPropertyDescriptorsTable[e.name],e._owner=null)}return e}},newEventDescriptor:{value:function(e){return(new p).initWithNameAndObjectDescriptor(e,this)}},addEventDescriptorNamed:{value:function(e){return this.addEventDescriptor(this.newEventDescriptor(e))}},eventDescriptorForName:{value:function(e){var t=this._eventPropertyDescriptorsTable[e];if("undefined"==typeof t){t=r.UnknownEventDescriptor;var o,i;for(i=0;"undefined"!=typeof(o=this._eventDescriptors[i]);i++)if(o.name===e){t=o;break}this._eventPropertyDescriptorsTable[e]=t}return t===r.UnknownEventDescriptor&&(t=null),!t&&this.parent&&(t=this.parent.eventDescriptorForName(e)),t}},_propertyValidationRules:{value:{}},propertyValidationRules:{get:function(){var e,r=[];for(e in this._propertyValidationRules)this._propertyValidationRules.hasOwnProperty(e)&&r.push(this._propertyValidationRules[e]);return this.parent&&(r=r.concat(this.parent.propertyValidationRules)),r}},propertyValidationRuleForName:{value:function(e){var r=this._propertyValidationRules[e];return!r&&this.parent&&(r=this.parent.propertyValidationRuleForName(e)),r}},addPropertyValidationRule:{value:function(e){var r=this._propertyValidationRules[e];return r||(r=(new c).initWithNameAndObjectDescriptor(e,this),this._propertyValidationRules[e]=r),r}},removePropertyValidationRule:{value:function(e){var r=this._propertyValidationRules[e];return r&&delete this._propertyValidationRules[e],r}},evaluateRules:{value:function(e){var r,t,o=[];for(r in this._propertyValidationRules)this._propertyValidationRules.hasOwnProperty(r)&&(t=this._propertyValidationRules[r],t.evaluateRule(e)&&o.push(t.messageKey));return o}},objectDescriptorModuleId:e("../core")._objectDescriptorModuleIdDescriptor,objectDescriptor:e("../core")._objectDescriptorDescriptor,addEventBlueprint:{value:u.deprecateMethod(void 0,function(e){return this.addEventDescriptor(e)},"addEventBlueprint","addEventDescriptor")},addEventBlueprintNamed:{value:u.deprecateMethod(void 0,function(e){return this.addEventDescriptorNamed(e)},"addEventBlueprintNamed","addEventDescriptorNamed")},addPropertyBlueprint:{value:u.deprecateMethod(void 0,function(e){this.addPropertyDescriptor(e)},"addPropertyBlueprint","addPropertyDescriptor")},addPropertyBlueprintGroupNamed:{value:u.deprecateMethod(void 0,function(e){this.addPropertyDescriptorGroupNamed(e)},"addPropertyBlueprintGroupNamed","addPropertyDescriptorGroupNamed")},addPropertyBlueprintToGroupNamed:{value:u.deprecateMethod(void 0,function(e,r){this.addPropertyDescriptorToGroupNamed(e,r)},"addPropertyBlueprintToGroupNamed","addPropertyDescriptorToGroupNamed")},addToOnePropertyBlueprintNamed:{value:u.deprecateMethod(void 0,function(e){return this.addToOnePropertyDescriptorNamed(e)},"addToOnePropertyBlueprintNamed","addToOnePropertyDescriptorNamed")},addToManyPropertyBlueprintNamed:{value:u.deprecateMethod(void 0,function(e){return this.addToManyPropertyDescriptorNamed(e)},"addToManyPropertyBlueprintNamed","addToManyPropertyDescriptorNamed")},blueprintInstanceModule:{serializable:!1,get:u.deprecateMethod(void 0,function(){return this.objectDescriptorInstanceModule},"blueprintInstanceModule.get","objectDescriptorInstanceModule.get"),set:u.deprecateMethod(void 0,function(e){this.objectDescriptorInstanceModule=e},"blueprintInstanceModule.set","objectDescriptorInstanceModule.set")},binder:{serializable:!1,get:u.deprecateMethod(void 0,function(){return this.model},"binder.get","model.get"),set:u.deprecateMethod(void 0,function(e){this.model=e},"binder.set","model.set")},eventBlueprintForName:{value:u.deprecateMethod(void 0,function(e){return this.eventDescriptorForName(e)},"eventBlueprintForName","eventDescriptorForName")},eventBlueprints:{get:u.deprecateMethod(void 0,function(){return this.eventDescriptors},"eventBlueprints.get","eventDescriptors.get"),set:u.deprecateMethod(void 0,function(e){this.eventDescriptors=e},"eventBlueprints.set","eventDescriptors.set")},newAssociationBlueprint:{value:function(e,r){return 1===r?this.addToOnePropertyDescriptorNamed(e):this.addToManyPropertyDescriptorNamed(e)}},newDerivedPropertyBlueprint:{value:u.deprecateMethod(void 0,function(e,r){return this.newDerivedDescriptor(e,r)},"newDerivedPropertyBlueprint","newDerivedDescriptor")},newDerivedDescriptor:{value:function(e,r){return(new i).initWithNameObjectDescriptorAndCardinality(e,this,r)}},newEventBlueprint:{value:u.deprecateMethod(void 0,function(e){return this.newEventDescriptor(e)},"newEventBlueprint","newEventDescriptor")},newPropertyBlueprint:{value:u.deprecateMethod(void 0,function(e,r){return this.newPropertyDescriptor(e,r)},"newPropertyBlueprint","newPropertyDescriptor")},propertyBlueprintForName:{value:u.deprecateMethod(void 0,function(e){return this.propertyDescriptorForName(e)},"propertyBlueprintForName","propertyDescriptorForName")},propertyBlueprintGroups:{get:u.deprecateMethod(void 0,function(){return this.propertyDescriptorGroups},"propertyBlueprintGroups","propertyDescriptorGroups")},propertyBlueprintGroupForName:{value:u.deprecateMethod(void 0,function(e){return this.propertyDescriptorGroupForName(e)},"propertyBlueprintGroupForName","propertyDescriptorForName")},propertyBlueprints:{get:u.deprecateMethod(void 0,function(){return this.propertyDescriptors},"propertyBlueprints","propertyDescriptors")},removeEventBlueprint:{value:u.deprecateMethod(void 0,function(e){this.removeEventDescriptor(e)},"removeEventBlueprint","removeEventDescriptor")},removePropertyBlueprint:{value:u.deprecateMethod(void 0,function(e){this.removePropertyDescriptor(e)},"removePropertyBlueprint","removePropertyDescriptor")},removePropertyBlueprintFromGroupNamed:{value:u.deprecateMethod(void 0,function(e,r){this.removePropertyDescriptorFromGroupNamed(e,r)},"removePropertyBlueprintFromGroupNamed","removePropertyDescriptorGroupNamed")},removePropertyBlueprintGroupNamed:{value:u.deprecateMethod(void 0,function(e){this.removePropertyDescriptorGroupNamed(e)},"removePropertyBlueprintGroupNamed","removePropertyDescriptorGroupNamed")},maxAge:{value:240},blueprintModuleId:e("../core")._objectDescriptorModuleIdDescriptor,blueprint:e("../core")._objectDescriptorDescriptor},{createDefaultBlueprintForObject:{value:u.deprecateMethod(void 0,function(e){return l.createDefaultObjectDescriptorForObject(e)},"Blueprint.createDefaultBlueprintForObject","ObjectDescriptor.createDefaultObjectDescriptorForObject")},createDefaultObjectDescriptorForObject:{value:function(e){if(e){var t=o.getInfoForObject(e).isInstance?Object.getPrototypeOf(e):e.prototype,i=o.getInfoForObject(t),p=new this;for(var n in t)if("_"!==n[0]&&t.hasOwnProperty(n)){var a,c=t[n];a=Array.isArray(c)?p.addToManyPropertyDescriptorNamed(n):p.addToOnePropertyDescriptorNamed(n),p.addPropertyDescriptorGroupNamed(a,i.objectName)}var u=Object.getPrototypeOf(t);return u&&"objectDescriptor"in u?u.objectDescriptor.then(function(e){return p.parent=e,p}):s.resolve(p)}return s.resolve(r.UnknownObjectDescriptor)}}});r.UnknownObjectDescriptor=Object.freeze((new l).initWithName("Unknown")),r.UnknownPropertyDescriptor=Object.freeze((new a).initWithNameObjectDescriptorAndCardinality("Unknown",null,1)),r.UnknownEventDescriptor=Object.freeze((new p).initWithNameAndObjectDescriptor("Unknown",null))}});