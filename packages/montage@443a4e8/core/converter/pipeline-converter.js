var Converter=require("./converter").Converter,Promise=require("core/promise").Promise;exports.PipelineConverter=Converter.specialize({deserializeSelf:{value:function(e){var r;r=e.getProperty("converters"),void 0!==r&&(this.converters=r)}},serializeSelf:{value:function(e){this.converters.length>0&&e.setProperty("converters",this.converters)}},converters:{value:void 0},convert:{value:function(e){return this._convertWithConverterAtIndex(e,0)}},_convertWithConverterAtIndex:{value:function(e,r){var t,n=this,i=this.converters[r],o=i.convert(e),v=r===this.converters.length-1,s=this._isThenable(o);return r++,t=v?s?o:Promise.resolve(o):s?o.then(function(e){return n._convertWithConverterAtIndex(e,r)}):this._convertWithConverterAtIndex(o,r)}},_isThenable:{value:function(e){return!(!e||!e.then||"function"!=typeof e.then)}},revert:{value:function(e){return this._revertWithConverterAtIndex(e,this.converters.length-1)}},_revertWithConverterAtIndex:{value:function(e,r){var t,n=this,i=this.converters[r],o=i.revert(e),v=0===r,s=this._isThenable(o);return r--,t=v?s?o:Promise.resolve(o):s?o.then(function(e){return n._revertWithConverterAtIndex(e,r)}):this._revertWithConverterAtIndex(o,r)}}});