montageDefine("ee896a8","lib/xhr2",{dependencies:["http","https","os","url"],factory:function(t,e,s){(function(){var e,r,o,n,i,h,p,a,l,u,d,_,c=function(t,e){function s(){this.constructor=t}for(var r in e)f.call(e,r)&&(t[r]=e[r]);return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t},f={}.hasOwnProperty;p=function(){function t(){this.onloadstart=null,this.onprogress=null,this.onabort=null,this.onerror=null,this.onload=null,this.ontimeout=null,this.onloadend=null,this._listeners={}}return t.prototype.onloadstart=null,t.prototype.onprogress=null,t.prototype.onabort=null,t.prototype.onerror=null,t.prototype.onload=null,t.prototype.ontimeout=null,t.prototype.onloadend=null,t.prototype.addEventListener=function(t,e){var s;t=t.toLowerCase(),(s=this._listeners)[t]||(s[t]=[]),this._listeners[t].push(e)},t.prototype.removeEventListener=function(t,e){var s;t=t.toLowerCase(),this._listeners[t]&&(s=this._listeners[t].indexOf(e),s!==-1&&this._listeners[t].splice(s,1))},t.prototype.dispatchEvent=function(t){var e,s,r,o,n;if(t.currentTarget=t.target=this,e=t.type,n=this._listeners[e])for(s=0,r=n.length;s<r;s++)o=n[s],o.call(this,t);(o=this["on"+e])&&o.call(this,t)},t}(),l=t("http"),u=t("https"),d=t("os"),_=t("url"),h=function(t){function s(t){s.__super__.constructor.call(this),this.onreadystatechange=null,this._anonymous=t&&t.anon,this.readyState=s.UNSENT,this.response=null,this.responseText="",this.responseType="",this.responseURL="",this.status=0,this.statusText="",this.timeout=0,this.upload=new a(this),this._method=null,this._url=null,this._sync=!1,this._headers=null,this._loweredHeaders=null,this._mimeOverride=null,this._request=null,this._response=null,this._responseParts=null,this._responseHeaders=null,this._aborting=null,this._error=null,this._loadedBytes=0,this._totalBytes=0,this._lengthComputable=!1}return c(s,t),s.prototype.onreadystatechange=null,s.prototype.readyState=null,s.prototype.response=null,s.prototype.responseText=null,s.prototype.responseType=null,s.prototype.status=null,s.prototype.timeout=null,s.prototype.upload=null,s.prototype.open=function(t,e,r,o,i){var h;if(t=t.toUpperCase(),t in this._restrictedMethods)throw new n("HTTP method "+t+" is not allowed in XHR");switch(h=this._parseUrl(e),void 0===r&&(r=!0),this.readyState){case s.UNSENT:case s.OPENED:case s.DONE:break;case s.HEADERS_RECEIVED:case s.LOADING:}this._method=t,this._url=h,this._sync=!r,this._headers={},this._loweredHeaders={},this._mimeOverride=null,this._setReadyState(s.OPENED),this._request=null,this._response=null,this.status=0,this.statusText="",this._responseParts=[],this._responseHeaders=null,this._loadedBytes=0,this._totalBytes=0,this._lengthComputable=!1},s.prototype.setRequestHeader=function(t,r){var o;if(this.readyState!==s.OPENED)throw new e("XHR readyState must be OPENED");return o=t.toLowerCase(),this._restrictedHeaders[o]||/^sec\-/.test(o)||/^proxy-/.test(o)?void console.warn('Refused to set unsafe header "'+t+'"'):(r=r.toString(),void(o in this._loweredHeaders?(t=this._loweredHeaders[o],this._headers[t]=this._headers[t]+", "+r):(this._loweredHeaders[o]=t,this._headers[t]=r)))},s.prototype.send=function(t){if(this.readyState!==s.OPENED)throw new e("XHR readyState must be OPENED");if(this._request)throw new e("send() already called");switch(this._url.protocol){case"file:":this._sendFile(t);break;case"http:":case"https:":this._sendHttp(t);break;default:throw new r("Unsupported protocol "+this._url.protocol)}},s.prototype.abort=function(){this._request&&(this._request.abort(),this._setError(),this._dispatchProgress("abort"),this._dispatchProgress("loadend"))},s.prototype.getResponseHeader=function(t){var e;return this._responseHeaders?(e=t.toLowerCase(),e in this._responseHeaders?this._responseHeaders[e]:null):null},s.prototype.getAllResponseHeaders=function(){var t,e,s;return this._responseHeaders?(t=function(){var t,r;t=this._responseHeaders,r=[];for(e in t)s=t[e],r.push(e+": "+s);return r}.call(this),t.join("\r\n")):""},s.prototype.overrideMimeType=function(t){if(this.readyState===s.LOADING||this.readyState===s.DONE)throw new e("overrideMimeType() not allowed in LOADING or DONE");this._mimeOverride=t.toLowerCase()},s.prototype.nodejsSet=function(t){var e,s;if("httpAgent"in t&&(this.nodejsHttpAgent=t.httpAgent),"httpsAgent"in t&&(this.nodejsHttpsAgent=t.httpsAgent),"baseUrl"in t){if(e=t.baseUrl,null!==e&&(s=_.parse(e,!1,!0),!s.protocol))throw new i("baseUrl must be an absolute URL");this.nodejsBaseUrl=e}},s.nodejsSet=function(t){s.prototype.nodejsSet(t)},s.prototype.UNSENT=0,s.UNSENT=0,s.prototype.OPENED=1,s.OPENED=1,s.prototype.HEADERS_RECEIVED=2,s.HEADERS_RECEIVED=2,s.prototype.LOADING=3,s.LOADING=3,s.prototype.DONE=4,s.DONE=4,s.prototype.nodejsHttpAgent=l.globalAgent,s.prototype.nodejsHttpsAgent=u.globalAgent,s.prototype.nodejsBaseUrl=null,s.prototype._restrictedMethods={CONNECT:!0,TRACE:!0,TRACK:!0},s.prototype._restrictedHeaders={"accept-charset":!0,"accept-encoding":!0,"access-control-request-headers":!0,"access-control-request-method":!0,connection:!0,"content-length":!0,cookie:!0,cookie2:!0,date:!0,dnt:!0,expect:!0,host:!0,"keep-alive":!0,origin:!0,referer:!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0,"user-agent":!0,via:!0},s.prototype._privateHeaders={"set-cookie":!0,"set-cookie2":!0},s.prototype._userAgent="Mozilla/5.0 ("+d.type()+" "+d.arch()+") "+("node.js/"+process.versions.node+" v8/"+process.versions.v8),s.prototype._setReadyState=function(t){var e;this.readyState=t,e=new o("readystatechange"),this.dispatchEvent(e)},s.prototype._sendFile=function(){if("GET"!==this._url.method)throw new r("The file protocol only supports GET");throw new Error("Protocol file: not implemented")},s.prototype._sendHttp=function(t){if(this._sync)throw new Error("Synchronous XHR processing not implemented");null==t||"GET"!==this._method&&"HEAD"!==this._method?t||(t=""):(console.warn("Discarding entity body for "+this._method+" requests"),t=null),this.upload._setData(t),this._finalizeHeaders(),this._sendHxxpRequest()},s.prototype._sendHxxpRequest=function(){var t,e,s;"http:"===this._url.protocol?(e=l,t=this.nodejsHttpAgent):(e=u,t=this.nodejsHttpsAgent),s=e.request({hostname:this._url.hostname,port:this._url.port,path:this._url.path,auth:this._url.auth,method:this._method,headers:this._headers,agent:t}),this._request=s,this.timeout&&s.setTimeout(this.timeout,function(t){return function(){return t._onHttpTimeout(s)}}(this)),s.on("response",function(t){return function(e){return t._onHttpResponse(s,e)}}(this)),s.on("error",function(t){return function(e){return t._onHttpRequestError(s,e)}}(this)),this.upload._startUpload(s),this._request===s&&this._dispatchProgress("loadstart")},s.prototype._finalizeHeaders=function(){this._headers.Connection="keep-alive",this._headers.Host=this._url.host,this._anonymous&&(this._headers.Referer="about:blank"),this._headers["User-Agent"]=this._userAgent,this.upload._finalizeHeaders(this._headers,this._loweredHeaders)},s.prototype._onHttpResponse=function(t,e){var r;if(this._request===t){switch(e.statusCode){case 301:case 302:case 303:case 307:case 308:return this._url=this._parseUrl(e.headers.location),this._method="GET","content-type"in this._loweredHeaders&&(delete this._headers[this._loweredHeaders["content-type"]],delete this._loweredHeaders["content-type"]),"Content-Type"in this._headers&&delete this._headers["Content-Type"],delete this._headers["Content-Length"],this.upload._reset(),this._finalizeHeaders(),void this._sendHxxpRequest()}return this._response=e,this._response.on("data",function(t){return function(s){return t._onHttpResponseData(e,s)}}(this)),this._response.on("end",function(t){return function(){return t._onHttpResponseEnd(e)}}(this)),this._response.on("close",function(t){return function(){return t._onHttpResponseClose(e)}}(this)),this.responseURL=this._url.href.split("#")[0],this.status=this._response.statusCode,this.statusText=l.STATUS_CODES[this.status],this._parseResponseHeaders(e),(r=this._responseHeaders["content-length"])?(this._totalBytes=parseInt(r),this._lengthComputable=!0):this._lengthComputable=!1,this._setReadyState(s.HEADERS_RECEIVED)}},s.prototype._onHttpResponseData=function(t,e){if(this._response===t)return this._responseParts.push(e),this._loadedBytes+=e.length,this.readyState!==s.LOADING&&this._setReadyState(s.LOADING),this._dispatchProgress("progress")},s.prototype._onHttpResponseEnd=function(t){if(this._response===t)return this._parseResponse(),this._request=null,this._response=null,this._setReadyState(s.DONE),this._dispatchProgress("load"),this._dispatchProgress("loadend")},s.prototype._onHttpResponseClose=function(t){var e;if(this._response===t)return e=this._request,this._setError(),e.abort(),this._setReadyState(s.DONE),this._dispatchProgress("error"),this._dispatchProgress("loadend")},s.prototype._onHttpTimeout=function(t){if(this._request===t)return this._setError(),t.abort(),this._setReadyState(s.DONE),this._dispatchProgress("timeout"),this._dispatchProgress("loadend")},s.prototype._onHttpRequestError=function(t,e){if(this._request===t)return this._setError(),t.abort(),this._setReadyState(s.DONE),this._dispatchProgress("error"),this._dispatchProgress("loadend")},s.prototype._dispatchProgress=function(t){var e;e=new o(t),e.lengthComputable=this._lengthComputable,e.loaded=this._loadedBytes,e.total=this._totalBytes,this.dispatchEvent(e)},s.prototype._setError=function(){this._request=null,this._response=null,this._responseHeaders=null,this._responseParts=null},s.prototype._parseUrl=function(t){var e,s,r,o,n;return e=null===this.nodejsBaseUrl?t:_.resolve(this.nodejsBaseUrl,t),n=_.parse(e,!1,!0),n.hash=null,n.auth&&("undefined"!=typeof o&&null!==o||"undefined"!=typeof r&&null!==r)&&(s=n.auth.indexOf(":"),s===-1?o||(o=n.auth):(o||(o=n.substring(0,s)),r||(r=n.substring(s+1)))),(o||r)&&(n.auth=o+":"+r),n},s.prototype._parseResponseHeaders=function(t){var e,s,r,o;this._responseHeaders={},r=t.headers;for(s in r)o=r[s],e=s.toLowerCase(),this._privateHeaders[e]||(null!==this._mimeOverride&&"content-type"===e&&(o=this._mimeOverride),this._responseHeaders[e]=o);null===this._mimeOverride||"content-type"in this._responseHeaders||(this._responseHeaders["content-type"]=this._mimeOverride)},s.prototype._parseResponse=function(){var t,e,s,r,o,n,i;switch(e=Buffer.concat?Buffer.concat(this._responseParts):this._concatBuffers(this._responseParts),this._responseParts=null,this.responseType){case"text":this._parseTextResponse(e);break;case"json":this.responseText=null;try{this.response=JSON.parse(e.toString("utf-8"))}catch(h){o=h,this.response=null}break;case"buffer":this.responseText=null,this.response=e;break;case"arraybuffer":for(this.responseText=null,t=new ArrayBuffer(e.length),i=new Uint8Array(t),s=r=0,n=e.length;0<=n?r<n:r>n;s=0<=n?++r:--r)i[s]=e[s];this.response=t;break;default:this._parseTextResponse(e)}},s.prototype._parseTextResponse=function(t){var e;try{this.responseText=t.toString(this._parseResponseEncoding())}catch(s){e=s,this.responseText=t.toString("binary")}this.response=this.responseText},s.prototype._parseResponseEncoding=function(){var t,e,s;return e=null,(t=this._responseHeaders["content-type"])&&(s=/\;\s*charset\=(.*)$/.exec(t))?s[1]:"utf-8"},s.prototype._concatBuffers=function(t){var e,s,r,o,n,i,h;if(0===t.length)return new Buffer(0);if(1===t.length)return t[0];for(i=0,s=0,o=t.length;s<o;s++)e=t[s],i+=e.length;for(h=new Buffer(i),i=0,r=0,n=t.length;r<n;r++)e=t[r],e.copy(h,i),i+=e.length;return h},s}(p),s.exports=h,h.XMLHttpRequest=h,n=function(t){function e(){e.__super__.constructor.apply(this,arguments)}return c(e,t),e}(Error),h.SecurityError=n,e=function(t){function e(){e.__super__.constructor.apply(this,arguments)}return c(e,t),e}(Error),e=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return c(e,t),e}(Error),h.InvalidStateError=e,r=function(t){function e(){e.__super__.constructor.apply(this,arguments)}return c(e,t),e}(Error),h.SyntaxError=i,i=function(t){function e(){e.__super__.constructor.apply(this,arguments)}return c(e,t),e}(Error),o=function(){function t(t){this.type=t,this.target=null,this.currentTarget=null,this.lengthComputable=!1,this.loaded=0,this.total=0}return t.prototype.bubbles=!1,t.prototype.cancelable=!1,t.prototype.target=null,t.prototype.loaded=null,t.prototype.lengthComputable=null,t.prototype.total=null,t}(),h.ProgressEvent=o,a=function(t){function e(t){e.__super__.constructor.call(this),this._request=t,this._reset()}return c(e,t),e.prototype._reset=function(){this._contentType=null,this._body=null},e.prototype._setData=function(t){var e,s,r,o,n,i,h,p;if("undefined"!=typeof t&&null!==t)if("string"==typeof t)0!==t.length&&(this._contentType="text/plain;charset=UTF-8"),this._body=new Buffer(t,"utf8");else if(Buffer.isBuffer(t))this._body=t;else if(t instanceof ArrayBuffer){for(e=new Buffer(t.byteLength),p=new Uint8Array(t),s=r=0,i=t.byteLength;0<=i?r<i:r>i;s=0<=i?++r:--r)e[s]=p[s];this._body=e}else{if(!(t.buffer&&t.buffer instanceof ArrayBuffer))throw new Error("Unsupported send() data "+t);for(e=new Buffer(t.byteLength),n=t.byteOffset,p=new Uint8Array(t.buffer),s=o=0,h=t.byteLength;0<=h?o<h:o>h;s=0<=h?++o:--o)e[s]=p[s+n];this._body=e}},e.prototype._finalizeHeaders=function(t,e){this._contentType&&("content-type"in e||(t["Content-Type"]=this._contentType)),this._body&&(t["Content-Length"]=this._body.length.toString())},e.prototype._startUpload=function(t){this._body&&t.write(this._body),t.end()},e}(p),h.XMLHttpRequestUpload=a}).call(this)}});